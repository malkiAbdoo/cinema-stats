import { NextRequest } from 'next/server';
import { ImageResponse } from '@vercel/og';
import { themeColors } from '@/data/constants';

export const config = {
  runtime: 'edge'
};

const interFont = fetch(new URL('../../../public/fonts/Inter.ttf', import.meta.url)).then(res =>
  res.arrayBuffer()
);

export default async function (request: NextRequest) {
  try {
    const fontData = await interFont;

    return new ImageResponse(
      (
        <div
          style={{
            display: 'flex',
            flexDirection: 'column',
            width: '100%',
            height: '100%',
            alignItems: 'center',
            justifyContent: 'center',
            color: themeColors.text.dark,
            backgroundColor: '#171717',
            backgroundImage: 'linear-gradient(180deg, #000, transparent)',
            gap: '2rem'
          }}
        >
          {logotype}
          <div
            style={{
              display: 'flex',
              fontFamily: 'Inter',
              fontSize: '2.44rem',
              letterSpacing: '-0.05em',
              fontWeight: '800',
              gap: '0.17em'
            }}
          >
            <div>Search, Download, or Save Images in your</div>
            <div style={{ color: themeColors.primary, filter: 'brightness(1.25)' }}>albums</div>
          </div>
        </div>
      ),
      {
        width: 1200,
        height: 630,
        fonts: [
          {
            name: 'Inter',
            data: fontData,
            weight: 400,
            style: 'normal'
          }
        ]
      }
    );
  } catch (e: any) {
    console.log(`${e.message}`);
    return new Response('Failed to generate the open-graph image', { status: 500 });
  }
}

const logotype = (
  <svg width="720" viewBox="0 0 143 39" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g clip-path="url(#clip0_1_2)">
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M19.5 39C30.2696 39 39 30.2696 39 19.5C39 8.73045 30.2696 0 19.5 0C8.73045 0 0 8.73045 0 19.5C0 30.2696 8.73045 39 19.5 39ZM19.578 36.972C29.1844 36.972 36.972 29.1844 36.972 19.578C36.972 9.97156 29.1844 2.184 19.578 2.184C9.97156 2.184 2.184 9.97156 2.184 19.578C2.184 29.1844 9.97156 36.972 19.578 36.972Z"
        fill="white"
      />
      <path
        d="M18.3802 0.0316121C18.7508 0.0106322 19.1242 0 19.5 0C30.2696 0 39 8.73045 39 19.5C39 20.2615 38.9564 21.0128 38.8714 21.7516C36.6328 23.3878 33.974 24.336 31.122 24.336C23.1525 24.336 16.692 16.9326 16.692 7.8C16.692 4.99211 17.3027 2.34767 18.3802 0.0316121Z"
        fill="white"
      />
      <path
        d="M0.000856934 19.6852C2.41243 17.6098 5.40988 16.38 8.65799 16.38C16.6275 16.38 23.088 23.7834 23.088 32.916C23.088 34.9971 22.7525 36.9884 22.1401 38.8228C21.2768 38.9396 20.3954 39 19.5 39C8.79226 39 0.100287 30.3695 0.000856934 19.6852Z"
        fill="white"
      />
      <path
        d="M51.85 29.25C50.9 29.25 50.0167 29.125 49.2 28.875C48.4 28.625 47.6667 28.25 47 27.75C46.35 27.2333 45.7667 26.6 45.25 25.85L47.1 23.725C47.9167 24.8917 48.7 25.7 49.45 26.15C50.2 26.6 51.0917 26.825 52.125 26.825C52.7583 26.825 53.3333 26.725 53.85 26.525C54.3667 26.325 54.775 26.05 55.075 25.7C55.375 25.35 55.525 24.95 55.525 24.5C55.525 24.2 55.475 23.9167 55.375 23.65C55.275 23.3833 55.1167 23.1417 54.9 22.925C54.7 22.7083 54.4333 22.5083 54.1 22.325C53.7833 22.1417 53.4083 21.9833 52.975 21.85C52.5417 21.7 52.0417 21.575 51.475 21.475C50.575 21.2917 49.7917 21.05 49.125 20.75C48.4583 20.45 47.9 20.075 47.45 19.625C47 19.175 46.6667 18.6667 46.45 18.1C46.2333 17.5167 46.125 16.8667 46.125 16.15C46.125 15.45 46.275 14.8 46.575 14.2C46.8917 13.6 47.3167 13.0833 47.85 12.65C48.4 12.2 49.0417 11.8583 49.775 11.625C50.5083 11.375 51.3 11.25 52.15 11.25C53.05 11.25 53.875 11.3667 54.625 11.6C55.375 11.8333 56.0417 12.1833 56.625 12.65C57.2083 13.1 57.6917 13.6583 58.075 14.325L56.175 16.2C55.8417 15.65 55.4667 15.1917 55.05 14.825C54.6333 14.4417 54.175 14.1583 53.675 13.975C53.175 13.775 52.6417 13.675 52.075 13.675C51.425 13.675 50.8583 13.775 50.375 13.975C49.8917 14.175 49.5083 14.4583 49.225 14.825C48.9583 15.175 48.825 15.5917 48.825 16.075C48.825 16.425 48.8917 16.75 49.025 17.05C49.1583 17.3333 49.3583 17.5917 49.625 17.825C49.9083 18.0417 50.2833 18.2417 50.75 18.425C51.2167 18.5917 51.775 18.7417 52.425 18.875C53.3417 19.075 54.1583 19.3333 54.875 19.65C55.5917 19.95 56.2 20.3083 56.7 20.725C57.2 21.1417 57.575 21.6083 57.825 22.125C58.0917 22.6417 58.225 23.2 58.225 23.8C58.225 24.9167 57.9667 25.8833 57.45 26.7C56.9333 27.5167 56.2 28.15 55.25 28.6C54.3 29.0333 53.1667 29.25 51.85 29.25ZM69.1506 29.25C67.9339 29.25 66.8173 29.0333 65.8006 28.6C64.7839 28.1667 63.9006 27.55 63.1506 26.75C62.4006 25.9333 61.8173 24.975 61.4006 23.875C61.0006 22.775 60.8006 21.5667 60.8006 20.25C60.8006 19 61.0173 17.8417 61.4506 16.775C61.9006 15.6917 62.5173 14.7417 63.3006 13.925C64.0839 13.1083 64.9923 12.475 66.0256 12.025C67.0589 11.575 68.1756 11.35 69.3756 11.35C70.2256 11.35 71.0506 11.4833 71.8506 11.75C72.6673 12 73.4006 12.3583 74.0506 12.825C74.7173 13.275 75.2589 13.7917 75.6756 14.375L73.8756 16.25C73.3923 15.7667 72.9006 15.3667 72.4006 15.05C71.9173 14.7167 71.4173 14.4667 70.9006 14.3C70.4006 14.1333 69.8923 14.05 69.3756 14.05C68.5589 14.05 67.7923 14.2083 67.0756 14.525C66.3756 14.825 65.7589 15.25 65.2256 15.8C64.7089 16.35 64.3006 17.0083 64.0006 17.775C63.7006 18.525 63.5506 19.35 63.5506 20.25C63.5506 21.2 63.6923 22.0667 63.9756 22.85C64.2756 23.6167 64.6923 24.275 65.2256 24.825C65.7589 25.375 66.3923 25.8 67.1256 26.1C67.8756 26.3833 68.7006 26.525 69.6006 26.525C70.1506 26.525 70.6923 26.45 71.2256 26.3C71.7589 26.15 72.2589 25.9333 72.7256 25.65C73.1923 25.3667 73.6173 25.0333 74.0006 24.65L75.3506 26.85C74.9673 27.3 74.4423 27.7083 73.7756 28.075C73.1256 28.4417 72.3923 28.7333 71.5756 28.95C70.7756 29.15 69.9673 29.25 69.1506 29.25ZM77.1934 29L83.9684 11.5H86.7184L93.4434 29H90.5684L86.5684 18.45C86.5184 18.3333 86.4184 18.05 86.2684 17.6C86.135 17.15 85.9767 16.65 85.7934 16.1C85.61 15.55 85.4434 15.05 85.2934 14.6C85.1434 14.1333 85.0434 13.8333 84.9934 13.7L85.5684 13.675C85.4684 13.9583 85.3434 14.3167 85.1934 14.75C85.06 15.1833 84.91 15.6417 84.7434 16.125C84.5934 16.6083 84.4434 17.0667 84.2934 17.5C84.1434 17.9167 84.0184 18.2667 83.9184 18.55L79.9434 29H77.1934ZM80.1934 24.65L81.1934 22.05H89.1434L90.2934 24.65H80.1934ZM98.6031 29V14.1H93.7031V11.5H106.353V14.1H101.303V29H98.6031ZM116.026 29.25C114.809 29.25 113.692 29.0333 112.676 28.6C111.659 28.1667 110.776 27.55 110.026 26.75C109.276 25.9333 108.692 24.975 108.276 23.875C107.876 22.775 107.676 21.5667 107.676 20.25C107.676 19 107.892 17.8417 108.326 16.775C108.776 15.6917 109.392 14.7417 110.176 13.925C110.959 13.1083 111.867 12.475 112.901 12.025C113.934 11.575 115.051 11.35 116.251 11.35C117.101 11.35 117.926 11.4833 118.726 11.75C119.542 12 120.276 12.3583 120.926 12.825C121.592 13.275 122.134 13.7917 122.551 14.375L120.751 16.25C120.267 15.7667 119.776 15.3667 119.276 15.05C118.792 14.7167 118.292 14.4667 117.776 14.3C117.276 14.1333 116.767 14.05 116.251 14.05C115.434 14.05 114.667 14.2083 113.951 14.525C113.251 14.825 112.634 15.25 112.101 15.8C111.584 16.35 111.176 17.0083 110.876 17.775C110.576 18.525 110.426 19.35 110.426 20.25C110.426 21.2 110.567 22.0667 110.851 22.85C111.151 23.6167 111.567 24.275 112.101 24.825C112.634 25.375 113.267 25.8 114.001 26.1C114.751 26.3833 115.576 26.525 116.476 26.525C117.026 26.525 117.567 26.45 118.101 26.3C118.634 26.15 119.134 25.9333 119.601 25.65C120.067 25.3667 120.492 25.0333 120.876 24.65L122.226 26.85C121.842 27.3 121.317 27.7083 120.651 28.075C120.001 28.4417 119.267 28.7333 118.451 28.95C117.651 29.15 116.842 29.25 116.026 29.25ZM137.318 29V11.5H140.018V29H137.318ZM125.893 29V11.5H128.593V29H125.893ZM127.068 21.575V18.975H138.518V21.575H127.068Z"
        fill="white"
      />
    </g>
    <defs>
      <clipPath id="clip0_1_2">
        <rect width="143" height="39" fill="white" />
      </clipPath>
    </defs>
  </svg>
);
